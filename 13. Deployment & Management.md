> [!tldr] More ways to deploy
## Deployment & Management
### Service Catalog

> tldr; A specific type of IT management database, self-service style for 'end users'

Used when different teams use a service style model. E.g. one team consumes another team's services... and maybe charges for the service

Key Product Information: Product Owner, Cost Requirements, Support Information, Dependancies

Designed to enable a business to manage costs and scale

AWS Service Catalog is an implementation of this concept
- Provides a self-service portal for end users
- Admins define the product and permissions
- Create 'Products' and organise into 'Portfolios'
	- CloudFormation Templates
	- Service Catalog configuration
	- End user permissions

Exam: Keyword: a way for end users to deploy services in a tightly managed way

### Elastic Beanstalk

> tldr; Platform as a service within AWS (PaaS)

End user can focus on code, not have to worry about deploying infrastructure

You provide code, Beanstalk orchestrates the infrastructure to run this code

Keywords: Getting application up and running as quickly as possible

Uses normal AWS stuff behind the scenes
- EB spins this up using CF behind the scenes
- You can influence what infra it uses

Custom config + application code can be committed to repo

Exam: Using Beanstalk requires app changes... not designed to be used by a non-technical end user
#### Platforms

> tldr; Beanstalk is capable of accepting code written in many different languages

Platforms:
- Natively supported runtimes
	- Go
	- Java/SE
	- .Net Core
	- .Net Windows
	- PHP
	- Python
	- Ruby
	- Tomcat
	- Node.js
- Docker
	- Single container
		- Pull image straight into EB from repo
	- Multi container
		- Uses ECS behind the scenes to co-ordinate containers
	- Pre-configured Docker
		- Provides support to runtimes that aren't natively supported
		- Example: Java Glassfish Java 8
		- Previously: Go (now natively supported)
- Custom Platforms
	- Create these using Packer

Supported Platforms runtimes: https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts.platforms.html

Key Concepts:
- Elastic Beanstalk Application
	- This isn't code
	- It's a container for everything related to an application
	- Includes code, infrastructure
- Within an Application
	- Environments
		- e.g. Prod, Test, Processing
	- You specify a tier, e.g worker tier, web tier
	- Each environment contains an ASG
		- These can be connected via SQS queues
- Deployment
	- Application Version
		- Something that belongs to an Application container
		- Also known as Source Bundles
		- Either .ZIP or .WAR files
	- Application Versions are deployed to Environments
	- Each gets a separate CNAME
	- We can test an environment, then swap CNAMEs if all works well
	- This is Blue/Green deployment
		- e.g. directing users to Prod after testing in Dev
	- Presets: Single Instance, High Availability etc
- Deployment Policies
	- All at once
		- Will cause downtime
	- Rolling - Deployment in batches
		- Loss in capacity when instances are removed
	- Rolling with additional batch
		- Extra instance(s) is added before rotating
	- Immutable
		- New temp ASG is created with updated instances
		- Once tested, they are moved to original ASG
	- Traffic Splitting
		- New temp ASG is created
		- Like immutable but we can adjust how much traffic goes to each ASG
	- Can also do manual Blue/Green deployments
		- This is just creating a second independent environment and switching over to it by updating CNAME after testing

Exam: You need to be a developer (not end user) and you need to adjust your application to fit into Beanstalk... the pay off is no need to spin up infrastructure separately

Exam: Databases should generally be created outside of the Beanstalk deployment... we need it to persist through environment changes, similar reasons to EKS

#### Elastic Beanstalk and RDS

> tldr; can create rds instance inside environment, or outside as a separate thing

Generally we only create RDS instances inside the environment for testing/development

Creating RDS outside gives us separation of Environment and Database

Process to get an RDS instance out from inside an EB Environment
- Create a snapshot of RDS
- Enable Deletion Protection
- Create new EB environment with same app version but no RDS
- Ensure new environment can connect to the DB
- Terminate old environment - EB will try to delete but we have delete protection
- Locate DELETE_FAILED, manually delete, and pick to retain stuck resources

#### Elastic Beanstalk Advanced Customisation

> tldr; you can create .ebextension files to customise infrastructure

EB is based on CloudFormation; the EB extensions are also based on CloudFormation

Inside the application source bundle:
- We create a .ebextensions folder
- Anything with YAML or JSON ending in .config is picked up
- Uses CFN format to create additional resources
- option_settings: allows you to set options of resources
- Resources allows entirely new resources

#### Elastic Beanstalk HTTPS

> tldr; need to add an SSL Cert to the loadbalancer

1. Go to EB Console -> Environment -> Load Balancer Config
2. Update Security Group configuration
	1. Allow Port 443
	2. Allow LB to connect to instance on relevant port

These can be done via .ebextensions too

#### Elastic Beanstalk Cloning

> tldr; you might want to duplicate an existing environment, e.g. prod -> test

Copies options, env variables, resources, other settings

RDS instances are cloned but **not the data**
(another reason to set up RDS externally)

Unmanaged changes are not included

Can do it from Console or CLI
- eb clone

#### Elastic Beanstalk and Docker

> tldr; single container or multicontainer

Single Container:
- Uses EC2 with Docker **NOT ECS**
- Not very efficient; one Docker container per EC2 instance
- Types of Docker deployments:
	- Dockerfile: EB will build a docker image and run it
	- Dockerrun.aws.json(version 1): Use an existing docker image, configures image ports, volumes and other config
	- Docker-compose.yml
Multi Container
- Creates an ECS cluster
	- This provisions EC2 instances and an ELB
- You need to provide a Dockerrun.aws.json (version 2) in the application source bundle (root level)
- Any images need to be stored in a container registry e.g. ECR


